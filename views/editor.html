<!DOCTYPE html>
<html lang="it">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

        <title>Editor di storie</title>
        <!-- BOOTSTRAP -->
        <link
            type="text/css"
            rel="stylesheet"
            href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css"
        />
        <link
            type="text/css"
            rel="stylesheet"
            href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
        />
        <link
            type="text/css"
            rel="stylesheet"
            href="../public/stylesheets/editor.css"
        />
        <!-- Load polyfills to support older browsers -->
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>

        <!-- Required scripts -->
        <script src="//unpkg.com/vue@latest/dist/vue.js"></script>
        <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
        <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue-icons.min.js"></script>
    </head>
    <body>
        <div id="app">
            <b-navbar sticky id="topbar" type="dark" class="py-0 px-0">
                <b-navbar-brand href="/editor" class="py-0 mx-5">
                    <img
                        src="../public/images/logo2.png"
                        alt="Cyber Logo"
                        height="46"
                    />
                </b-navbar-brand>
                <b-navbar-nav>
                    <custom-navbar-item
                        :item="item"
                        v-for="item in navbar_items"
                    >
                    </custom-navbar-item>
                </b-navbar-nav>
            </b-navbar>
            <b-container fluid v-if="navbar_items[0].isActive">
                <b-row>
                    <b-col cols="auto" class="mr-auto ml-4">
                        <b-list-group class="tabs" horizontal>
                            <custom-list-item
                                :item="item"
                                v-for="item in list_items_stories"
                            ></custom-list-item>
                        </b-list-group>
                    </b-col>
                    <b-col cols="4" class="my-2 px-0">
                        <b-input-group id="searchbar" class="px-1">
                            <b-input-group-prepend is-text>
                                <b-icon-search></b-icon-search>
                            </b-input-group-prepend>
                            <b-form-input
                                spellcheck="false"
                                type="search"
                                placeholder="Cerca"
                                v-model="story_filter"
                            ></b-form-input>
                        </b-input-group>
                    </b-col>
                    <b-col cols="auto" class="my-2 mr-3 px-0">
                        <b-button
                            class="px-4"
                            @click="$bvModal.show('modal-add-simple-story')"
                            >Crea Nuova Storia</b-button
                        >
                        <b-button
                            class="px-4"
                            @click="$bvModal.show('modal-add-simple-story')"
                            >Importa</b-button
                        >
                        <b-button
                            class="px-4"
                            @click="$bvModal.show('modal-add-simple-story')"
                            >Esporta</b-button
                        >
                        <add-simple-story-modal></add-simple-story-modal>
                    </b-col>
                </b-row>
                <b-row>
                    <b-col>
                        <b-table
                            v-if="list_items_stories[0].isActive"
                            borderless
                            hover
                            :busy="isBusy"
                            :filter="story_filter"
                            :filter-included-fields="filter_field"
                            :items="availableStories"
                            :fields="stories_fields"
                            tbody-tr-class="table-row"
                            thead-class="cell-title"
                        >
                            <template v-slot:cell(actions)="data">
                                <b-button
                                    size="sm"
                                    style="background-color: #8f65fc"
                                    @click="onPublish(data)"
                                >
                                    <b-icon-play-fill></b-icon-play-fill>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #003086"
                                    @click="onArchive(data)"
                                >
                                    <b-icon-archive-fill></b-icon-archive-fill>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #ff3d4a"
                                    @click="onDelete(data)"
                                >
                                    <b-icon-trash-fill></b-icon-trash-fill>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #00bec8"
                                    @click="onEdit(data)"
                                >
                                    <modal-edit-story
                                        :storia="data.item"
                                        :missions="missions"
                                    ></modal-edit-story>
                                    <b-icon-pencil-square></b-icon-pencil-square>
                                </b-button>

                                <b-button
                                    size="sm"
                                    style="background-color: #ffa300"
                                    @click="onClone(data)"
                                >
                                    <b-icon-back></b-icon-back>
                                </b-button>
                            </template>
                            <template v-slot:table-busy>
                                <div class="text-center text-danger my-2">
                                    <b-spinner class="align-middle"></b-spinner>
                                    <strong>Loading...</strong>
                                </div>
                            </template>
                        </b-table>
                        <b-table
                            v-if="list_items_stories[1].isActive"
                            borderless
                            hover
                            :busy="isBusy"
                            :filter="story_filter"
                            :filter-included-fields="filter_field"
                            :items="archivedStories"
                            :fields="stories_fields"
                            tbody-tr-class="table-row"
                            thead-class="cell-title"
                        >
                            <template v-slot:cell(actions)="data">
                                <b-button
                                    size="sm"
                                    style="background-color: #8f65fc"
                                    @click="onPublish(data)"
                                >
                                    <b-icon-play-fill></b-icon-play-fill>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #003086"
                                    @click="onArchive(data)"
                                >
                                    <b-icon-archive-fill></b-icon-archive-fill>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #ff3d4a"
                                    @click="onDelete(data)"
                                >
                                    <b-icon-trash-fill></b-icon-trash-fill>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #00bec8"
                                    @click="onEdit(data)"
                                >
                                    <b-icon-pencil-square></b-icon-pencil-square>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #ffa300"
                                    @click="onClone(data)"
                                >
                                    <b-icon-back></b-icon-back>
                                </b-button>
                            </template>
                            <template v-slot:table-busy>
                                <div class="text-center text-danger my-2">
                                    <b-spinner class="align-middle"></b-spinner>
                                    <strong>Loading...</strong>
                                </div>
                            </template>
                        </b-table>
                    </b-col>
                </b-row>
            </b-container>
            <b-container fluid v-if="navbar_items[1].isActive">
                <b-row>
                    <b-col cols="auto" class="mr-auto ml-4">
                        <b-list-group class="tabs" horizontal>
                            <custom-list-item
                                :item="item"
                                v-for="item in list_items_missions"
                            ></custom-list-item>
                        </b-list-group>
                    </b-col>
                    <b-col cols="4" class="my-2 px-0">
                        <b-input-group id="searchbar" class="px-1">
                            <b-input-group-prepend is-text>
                                <b-icon-search></b-icon-search>
                            </b-input-group-prepend>
                            <b-form-input
                                spellcheck="false"
                                type="search"
                                placeholder="Cerca missioni..."
                                v-model="mission_filter"
                            ></b-form-input>
                        </b-input-group>
                    </b-col>
                    <b-col cols="auto" class="my-2 mr-3 px-0">
                        <b-button
                            class="px-4"
                            @click="$bvModal.show('modal-add-mission')"
                            >Aggiungi Nuova Missione</b-button
                        >
                    </b-col>
                </b-row>
                <b-row>
                    <b-col>
                        <b-table
                            borderless
                            hover
                            :busy="isBusy"
                            :filter="mission_filter"
                            :filter-included-fields="filter_field"
                            :items="missions"
                            :fields="missions_fields"
                            tbody-tr-class="table-row"
                            thead-class="cell-title"
                        >
                            <template v-slot:cell(actions)="data">
                                <b-button
                                    size="sm"
                                    style="background-color: #ff3d4a"
                                    @click="onDeleteMission(data)"
                                >
                                    <b-icon-trash-fill></b-icon-trash-fill>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #00bec8"
                                    @click="onEditMission(data)"
                                >
                                    <b-icon-pencil-square></b-icon-pencil-square>
                                    <modal-edit-mission
                                        :mission="data.item"
                                    ></modal-edit-mission>
                                </b-button>
                                <b-button
                                    size="sm"
                                    style="background-color: #ffa300"
                                    @click="onCloneMission(data)"
                                >
                                    <b-icon-back></b-icon-back>
                                </b-button>
                            </template>
                            <template v-slot:table-busy>
                                <div class="text-center text-danger my-2">
                                    <b-spinner class="align-middle"></b-spinner>
                                    <strong>Loading...</strong>
                                </div>
                            </template>
                        </b-table>
                    </b-col>
                </b-row>
            </b-container>
            <b-container fluid v-if="navbar_items[2].isActive">
                <b-row> </b-row>
            </b-container>
        </div>

        <template id="custom-navbar-item">
            <b-nav-item
                :class="{ active : item.isActive }"
                @click="onClick"
                class="py-2 px-4"
            >
                {{item.name}}
            </b-nav-item>
        </template>

        <template id="custom-list-item">
            <b-list-group-item
                button
                class="px-2"
                :class="{ active : item.isActive }"
                @click="onClick"
            >
                <h3>{{ item.name }}</h3>
            </b-list-group-item>
        </template>

        <template id="modal-edit-mission-template">
            <b-modal size="xl" :id="modalId">
                <template v-slot:modal-header>
                    <b-container>
                        <b-row>
                            <b-col cols="auto" class="mr-auto my-auto ml-4">
                                <h4>{{ mission.title }}</h4>
                            </b-col>
                            <b-col cols="auto" class="mr-3 px-0">
                                <b-button
                                    class="px-4"
                                    @click="$bvModal.hide(modalId)"
                                    >X</b-button
                                >
                            </b-col>
                        </b-row>
                    </b-container>
                </template>
                <template v-slot:modal-footer="{ ok ,hide}">
                    <b-button @click="ok()"> Salva </b-button>
                    <b-button @click="hide()"> Chiudi </b-button>
                </template>
                <template v-slot:default>
                    <b-container>
                        <b-row>
                            <b-col>
                                <b-list-group>
                                    <b-list-group-item
                                        >Percorso 1</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Percorso 2</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Percorso 3</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Percorso 4</b-list-group-item
                                    >
                                </b-list-group>
                            </b-col>
                            <b-col>
                                <b-list-group>
                                    <b-list-group-item
                                        >Attività 1</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Attività 2</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Attività 3</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Attività 4</b-list-group-item
                                    >
                                </b-list-group>
                            </b-col>
                            <b-col>
                                <b-list-group>
                                    <b-list-group-item
                                        >Attività 1</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Attività 2</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Attività 3</b-list-group-item
                                    >
                                    <b-list-group-item
                                        >Attività 4</b-list-group-item
                                    >
                                </b-list-group>
                            </b-col>
                            <b-col> Info </b-col>
                        </b-row>
                    </b-container>
                </template>
            </b-modal>
        </template>

        <template id="add-simple-story-modal">
            <b-modal
                size="lg"
                id="modal-add-simple-story"
                title="Aggiungi una nuova storia"
                hide-footer
            >
                <b-container fluid>
                    <b-form @submit="onSubmit" @reset="onReset">
                        <b-form-group label="Titolo:" label-for="title">
                            <b-form-input
                                type="text"
                                v-model="form.title"
                                required
                                placeholder="Inserisci il titolo..."
                            ></b-form-input>
                        </b-form-group>
                        <div>
                            <b-form-group label="Età">
                                <b-form-checkbox-group v-model="eta">
                                    <b-form-checkbox value="sette"
                                        >7-10</b-form-checkbox
                                    >
                                    <b-form-checkbox value="undici"
                                        >11-14</b-form-checkbox
                                    >
                                    <b-form-checkbox value="quindici"
                                        >15-18</b-form-checkbox
                                    >
                                </b-form-checkbox-group>
                            </b-form-group>
                            <b-form-group label="Giocatore">
                                <b-form-checkbox-group v-model="giocatore">
                                    <b-form-checkbox value="singolo"
                                        >Singolo</b-form-checkbox
                                    >
                                    <b-form-checkbox value="gruppo"
                                        >Gruppo</b-form-checkbox
                                    >
                                    <b-form-checkbox value="classe"
                                        >Classe</b-form-checkbox
                                    >
                                </b-form-checkbox-group>
                            </b-form-group>
                        </div>
                        <b-button variant="primary" type="submit"
                            >Salva</b-button
                        >
                        <b-button variant="secondary" type="reset"
                            >Indietro</b-button
                        >
                        <b-overlay :show="show" no-wrap></b-overlay>
                    </b-form>
                </b-container>
            </b-modal>
        </template>

        <template id="modal-edit-story">
            <b-modal :id="modalId" size="xl" :title="storia.title">
                <template v-slot:modal-header>
                    <b-container fluid class="px-0 py-0 mx-0 my-0">
                        <b-row class="px-0 py-0 mx-0 my-0">
                            <b-col
                                cols="auto"
                                class="mr-auto my-auto ml-4 px-0 py-3"
                            >
                                <h4 class="my-0">{{ storia.title }}</h4>
                            </b-col>
                            <b-col
                                cols="auto"
                                class="mr-3 my-auto ml-4 py-auto"
                            >
                                <b-button class="px-4" @click="showQrCode"
                                    >QR CODE</b-button
                                >
                                <b-modal id="modal-qr-code" centered ok-only>
                                    <template v-slot:modal-header>
                                        <b-row class="py-2 mx-auto">
                                            QR CODE
                                        </b-row>
                                    </template>
                                    <template v-slot:default>
                                        <b-container
                                            fluid
                                            class="d-flex justify-content-center"
                                        >
                                            <b-row
                                                class="d-flex justify-content-center"
                                            >
                                                <b-col class="py-3">
                                                    <span id="qrcode"></span>
                                                </b-col>
                                            </b-row>
                                        </b-container>
                                    </template>
                                </b-modal>
                            </b-col>
                        </b-row>
                    </b-container>
                </template>
                <template v-slot:default>
                    <b-container fluid class="p-0 m-0">
                        <b-row class="p-0 m-0">
                            <b-col class="p-0 m-0 menu" cols="2">
                                <b-list-group>
                                    <b-list-group-item
                                        button
                                        v-for="item in list_item_edit_story"
                                        @click="onEditStoryMenuClick"
                                        :class="{ active : item.isActive }"
                                    >
                                        <h5>{{item.name}}</h5>
                                    </b-list-group-item>
                                </b-list-group>
                            </b-col>
                            <b-col
                                class="mission-group-item disponibili"
                                cols="6"
                                v-if="list_item_edit_story[0].isActive"
                            >
                                <b-row class="m-0 p-0">
                                    <b-col cols="auto" class="mr-auto p-0 mt-2">
                                        <h3>Disponibili</h3>
                                    </b-col>
                                    <b-col cols="6" class="my-2 px-0">
                                        <b-input-group class="px-0">
                                            <b-form-input
                                                spellcheck="false"
                                                type="search"
                                                placeholder="Cerca"
                                                v-model="mission_filter"
                                            ></b-form-input>
                                        </b-input-group>
                                    </b-col>
                                </b-row>
                                <b-row>
                                    <b-col class="scrollable px-3 py-3 m-0">
                                        <b-list-group>
                                            <b-list-group-item
                                                v-for="mission in filteredMissions"
                                                class="px-0 py-2 my-1"
                                                button
                                                @click="onAvailableMissionClick(mission)"
                                                :class="checkMission(mission)"
                                            >
                                                {{ mission.title }}
                                            </b-list-group-item>
                                        </b-list-group>
                                    </b-col>
                                </b-row>
                            </b-col>
                            <b-col
                                class="mission-group-item disponibili"
                                cols="4"
                                v-if="list_item_edit_story[0].isActive"
                            >
                                <b-row class="m-0 p-0">
                                    <b-col class="p-0 mt-2 mb-1">
                                        <h3 style="height: 34px">Aggiunte</h3>
                                    </b-col>
                                </b-row>
                                <b-row>
                                    <b-col class="scrollable px-3 py-3 m-0">
                                        <h6 v-if="storia.missions.length == 0">Aggiungi qualche missione...</h6>
                                        <b-list-group v-else>
                                            <b-list-group-item
                                                v-for="mission in storia.missions "
                                                class="px-0 py-2 my-1"
                                                button
                                            >
                                                {{ mission.title }}
                                            </b-list-group-item>
                                        </b-list-group>
                                    </b-col>
                                </b-row>
                            </b-col>

                            <b-col
                                class="mission-group-item selezionate"
                                v-if="list_item_edit_story[1].isActive"
                                cols="3"
                            >
                                <b-row class="m-0 p-0">
                                    <b-col class="p-0 mt-2 mb-1">
                                        <h3 style="height: 34px">Missioni</h3>
                                    </b-col>
                                </b-row>
                                <b-row>
                                    <b-col class="scrollable px-3 py-3 m-0">
                                        <h6 v-if="storia.missions.length == 0">Aggiungi qualche missione...</h6>
                                        <b-list-group v-else>
                                            <b-list-group-item
                                                v-for="mission in storia.missions "
                                                class="px-0 py-2 my-1"
                                                button
                                                @click="showMissionInfos(mission)"
                                            >
                                                {{ mission.title }}
                                            </b-list-group-item>
                                        </b-list-group>
                                    </b-col>
                                </b-row>
                            </b-col>
                            <b-col
                                class="mission-group-item disponibili"
                                v-if="list_item_edit_story[1].isActive"
                                cols="7"
                            >
                            </b-col>

                            <b-col
                                class="info"
                                v-if="list_item_edit_story[2].isActive"
                                cols="7"
                            >
                                <b-container fluid>
                                    <b-row>
                                        <b-col cols="auto" class="mx-0 px-0 pt-2 mt-1">
                                            <label>
                                            <h4>Titolo della storia:</h4>
                                            </label>
                                         </b-col> 
                                         <b-col cols="auto" class="mx-0 px-0 pt-2 pl-2"> 
                                           <b-form-input
                                            class="edit-title"
                                            type="text"
                                            required
                                            :placeholder="storia.title"
                                            maxlength="20"
                                            ></b-form-input>
                                         </b-col>  
                                    </b-row>
                                </b-container>
                            </b-col>
                        </b-row>
                    </b-container>
                </template>
                <template v-slot:modal-footer> </template>
            </b-modal>
        </template>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <!-- CUSTOM -->
        <script src="/public/javascripts/editor.js"></script>
        <script src="../public/javascripts/kjua-0.9.0.min.js"></script>
    </body>
</html>
